<?xml version="1.0"?>
<robot name="virat" xmlns:xacro="http://ros.org/wiki/xacro">

	<xacro:property name="body_mass" value="50"/>
	<xacro:property name="rear_wheel_mass" value="5"/>
	<xacro:property name="castor_mass" value="15"/>
	<xacro:property name="camera_mass" value="0.2"/>

	<xacro:macro name="default_inertial" params="mass">
		<inertial>
			<origin rpy="0.0 0 0" xyz="0 0 0"/>
			<mass value="${mass}" />
			<inertia ixx="1" ixy="0.0" ixz="0.0" iyy="1" iyz="0.0" izz="1" />
		</inertial>
	</xacro:macro>

	<xacro:macro name="surface_coefficients">
	 		<surface>
				<bounce>
					<restitution_coefficient>0.00000000000000001</restitution_coefficient>
					<threshold>0.5</threshold>
				</bounce>

        			<friction>
        				<ode>
        					<mu>100000000000</mu>
        					<mu2>100000000000</mu2>
        				</ode>
        			</friction>
        		</surface>
        </xacro:macro>

	<link name="base_link"/>
	<link name="odom"/>

	<joint name="odom_joint" type="fixed">
		<parent link="base_link"/>
		<child link="odom"/>
		<origin xyz="0 0 0"/>
	</joint>

	<link name="body">
		<visual>

			<origin  xyz="0 0 0"/>

			<geometry>
				<mesh filename="package://viratsim/meshes/body/bot2.dae"/>
        		</geometry>


		</visual>

		<collision>
			<origin  xyz="0 0 0"/>

			<geometry>
				<mesh filename="package://viratsim/meshes/body/bot2.dae"/>
			</geometry>

		</collision>

		<xacro:default_inertial mass="${body_mass}"/>

	</link>

	<joint name="dummy_joint" type="fixed">
		<parent link="base_link"/>
		<child link="body"/>
		<origin xyz="0 0 0"/>
	</joint>

	<link name="front_wheel">
		<visual>
			<origin  xyz="0 0 0"/>

			<geometry>
				<mesh filename="package://viratsim/meshes/wheels/castors1.dae"/>
        		</geometry>


		</visual>

		<collision>
			<origin  xyz="0 0 0"/>

			<geometry>
				<mesh filename="package://viratsim/meshes/wheels/castors1.dae"/>
        		</geometry>

              		<xacro:surface_coefficients/>

		</collision>

		<xacro:default_inertial mass="${castor_mass}"/>
	</link>

	<joint name="front_axle" type="fixed">
		<parent link="body"/>
		<child link="front_wheel"/>
		<origin xyz="0.48 0 0.02"/>
		<joint_properties friction="100"/>
	</joint>

	<link name="rear_wheel_1">
		<visual>

			<origin  xyz="0 0 0"/>

			<geometry>
				<mesh filename="package://viratsim/meshes/wheels/tyre1.dae"/>
        		</geometry>


		</visual>

		<collision>

			<origin  xyz="0 0 0"/>

			<geometry>
				<mesh filename="package://viratsim/meshes/wheels/tyre1.dae"/>
        		</geometry>

        		<xacro:surface_coefficients/>


		</collision>

		<xacro:default_inertial mass="${rear_wheel_mass}"/>
	</link>

	<joint name="rear_axle_1" type="continuous">
		<parent link="body"/>
		<child link="rear_wheel_1"/>
		<origin xyz="0 -0.323 0"/>
		<axis xyz="0 1 0" rpy="0 0 0"/>
		<joint_properties friction="100"/>
	</joint>


	<link name="rear_wheel_2">
		<visual>

			<origin  xyz="0 0 0"/>

			<geometry>
				<mesh filename="package://viratsim/meshes/wheels/tyre1.dae"/>
        		</geometry>


		</visual>

		<collision>

			<origin  xyz="0 0 0"/>

			<geometry>
				<mesh filename="package://viratsim/meshes/wheels/tyre1.dae"/>
        		</geometry>

        		<xacro:surface_coefficients/>

		</collision>

		<xacro:default_inertial mass="${rear_wheel_mass}"/>
	</link>

	<joint name="rear_axle_2" type="continuous">
		<parent link="body"/>
		<child link="rear_wheel_2"/>
		<origin xyz="0 0.323 0"/>
		<axis xyz="0 1 0" rpy="0 0 0"/>
		<joint_properties friction="100"/>
	</joint>

	<gazebo reference="camera">
		<sensor type="camera" name="camera">
		<update_rate>30.0</update_rate>
			<camera name="head">
				<horizontal_fov>1.3962634</horizontal_fov>
				<image>
				  <width>800</width>
				  <height>800</height>
				  <format>R8G8B8</format>
				</image>
				<clip>
				  <near>0.02</near>
				  <far>300</far>
				</clip>
				<noise>
				  <type>gaussian</type>
				  <mean>0.0</mean>
				  <stddev>0.007</stddev>
				</noise>
			</camera>
			<plugin name="camera_controller" filename="libgazebo_ros_camera.so">
				<alwaysOn>true</alwaysOn>
				<updateRate>0.0</updateRate>
				<cameraName>/virat/camera</cameraName>
				<imageTopicName>image_raw</imageTopicName>
				<cameraInfoTopicName>camera_info</cameraInfoTopicName>
				<frameName>camera</frameName>
				<hackBaseline>0.07</hackBaseline>
				<distortionK1>0.0</distortionK1>
				<distortionK2>0.0</distortionK2>
				<distortionK3>0.0</distortionK3>
				<distortionT1>0.0</distortionT1>
				<distortionT2>0.0</distortionT2>
			</plugin>
		</sensor>
	</gazebo>

	<link name="camera">
		<visual>
			<geometry>
				<box size="0.05 0.05 0.05"/>
			</geometry>
		</visual>

		<collision>
			<geometry>
				<box size="0.05 0.05 0.05"/>
			</geometry>
		</collision>

		<xacro:default_inertial mass="${camera_mass}"/>
	</link>

	<joint name="camera_joint" type="fixed">
		<origin xyz="0.73 0 1.18" rpy="0 0.45 0"/>
		<parent link="base_link"/>
		<child link="camera"/>
	</joint>


	<gazebo>
	<plugin name="differential_drive_controller" filename="libgazebo_ros_diff_drive.so">

	<!-- Plugin update rate in Hz -->
	<updateRate>30</updateRate>

	<!-- Name of left joint, defaults to `left_joint` -->
	<leftJoint>rear_axle_1</leftJoint>

	<!-- Name of right joint, defaults to `right_joint` -->
	<rightJoint>rear_axle_2</rightJoint>

	<!-- The distance from the center of one wheel to the other, in meters, defaults to 0.34 m -->
	<wheelSeparation>0.646</wheelSeparation>

	<!-- Diameter of the wheels, in meters, defaults to 0.15 m -->
	<wheelDiameter>0.15</wheelDiameter>

	<!-- Wheel acceleration, in rad/s^2, defaults to 0.0 rad/s^2 -->
	<wheelAcceleration>1.0</wheelAcceleration>

	<!-- Maximum torque which the wheels can produce, in Nm, defaults to 5 Nm -->
	<wheelTorque>200000</wheelTorque>

	<!-- Topic to receive geometry_msgs/Twist message commands, defaults to `cmd_vel` -->
	<commandTopic>cmd_vel</commandTopic>

	<!-- Topic to publish nav_msgs/Odometry messages, defaults to `odom` -->
	<odometryTopic>odom</odometryTopic>

	<!-- Odometry frame, defaults to `odom` -->
	<odometryFrame>odom</odometryFrame>

	<!-- Robot frame to calculate odometry from, defaults to `base_footprint` -->
	<robotBaseFrame>base_footprint</robotBaseFrame>

	<!-- Odometry source, 0 for ENCODER, 1 for WORLD, defaults to WORLD -->
	<odometrySource>1</odometrySource>

	<!-- Set to true to publish transforms for the wheel links, defaults to false -->
	<publishWheelTF>true</publishWheelTF>

	<!-- Set to true to publish transforms for the odometry, defaults to true -->
	<publishOdom>true</publishOdom>

	<!-- Set to true to publish sensor_msgs/JointState on /joint_states for the wheel joints, defaults to false -->
	<publishWheelJointState>true</publishWheelJointState>

	<!-- Set to true to swap right and left wheels, defaults to true -->
	<legacyMode>false</legacyMode>
	</plugin>

</gazebo>
</robot>
